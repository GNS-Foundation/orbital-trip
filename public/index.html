<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orbital TrIP — Space Object Identity Registry</title>
<meta name="description" content="Open public registry for satellite identity via cryptographic Proof-of-Trajectory. Live CelesTrak data, Ed25519 breadcrumb chains, trust scoring for 100+ satellites.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--panel:#111827;--border:#1e293b;--cyan:#0ea5e9;--green:#22c55e;--yellow:#eab308;--orange:#f97316;--red:#ef4444;--gray:#64748b;--light:#e2e8f0;--white:#f8fafc}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--light);overflow:hidden;height:100vh}
.mono{font-family:'JetBrains Mono',monospace}

header{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;border-bottom:1px solid var(--border);background:var(--panel);height:44px}
header h1{font-size:15px;font-weight:700;letter-spacing:1px}
header h1 span{color:var(--cyan)}
header .subtitle{color:var(--gray);font-size:11px;margin-left:12px}
header .stats{font-size:10px;color:var(--gray);padding:4px 10px;border:1px solid var(--border);border-radius:4px;display:flex;align-items:center;gap:8px}
header .stats b{color:var(--cyan)}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.layout{display:grid;grid-template-columns:280px 1fr 380px;height:calc(100vh - 44px)}

/* LEFT PANEL */
.left{border-right:1px solid var(--border);overflow-y:auto;background:var(--panel);display:flex;flex-direction:column}
.search-box{padding:8px;border-bottom:1px solid var(--border)}
.search-box input{width:100%;padding:6px 10px;background:#0f172a;border:1px solid var(--border);color:var(--light);border-radius:4px;font-size:12px;font-family:'DM Sans',sans-serif;outline:none}
.search-box input:focus{border-color:var(--cyan)}
.search-box input::placeholder{color:var(--gray)}
.filters{padding:6px 8px;display:flex;flex-wrap:wrap;gap:3px;border-bottom:1px solid var(--border)}
.filters button{font-size:9px;padding:2px 7px;border:1px solid var(--border);background:transparent;color:var(--gray);border-radius:3px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.filters button.active{background:var(--cyan);color:var(--bg);border-color:var(--cyan)}
.filters button:hover{border-color:var(--cyan)}
.sat-list{list-style:none;overflow-y:auto;flex:1}
.sat-item{display:flex;align-items:center;padding:6px 10px;cursor:pointer;border-bottom:1px solid #0f172a;gap:8px;transition:background .15s}
.sat-item:hover{background:#1e293b}
.sat-item.selected{background:#1e293b;border-left:3px solid var(--cyan)}
.sat-item.story{background:rgba(14,165,233,.05)}
.sat-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.sat-info{flex:1;min-width:0}
.sat-name{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sat-meta{font-size:9px;color:var(--gray)}
.sat-score{font-size:12px;font-weight:700;flex-shrink:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;border:2px solid}
.sat-story-badge{font-size:8px;color:var(--cyan);background:rgba(14,165,233,.15);padding:1px 4px;border-radius:2px;margin-left:4px}

/* CENTER - MAP */
.center{position:relative;overflow:hidden}
canvas#map{width:100%;height:100%;display:block}
.legend{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:14px;font-size:9px;color:var(--gray);background:rgba(10,14,23,.9);padding:4px 12px;border-radius:4px;border:1px solid var(--border)}
.legend span::before{content:'';display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:3px;vertical-align:middle}
.legend .l-odysseus::before{background:var(--green)}
.legend .l-voyager::before{background:var(--cyan)}
.legend .l-pathfinder::before{background:var(--yellow)}
.legend .l-explorer::before{background:var(--orange)}
.legend .l-seedling::before{background:var(--red)}
.data-source{position:absolute;top:10px;right:10px;font-size:9px;color:var(--gray);background:rgba(10,14,23,.9);padding:4px 10px;border-radius:4px;border:1px solid var(--border)}
.data-source b{color:var(--cyan)}

/* RIGHT PANEL */
.right{border-left:1px solid var(--border);overflow-y:auto;background:var(--panel);padding:14px}
.section-title{font-size:10px;letter-spacing:2px;color:var(--gray);margin:14px 0 6px;text-transform:uppercase}
.section-title:first-child{margin-top:0}
.detail-name{font-size:18px;font-weight:700;color:var(--cyan)}
.detail-sub{font-size:11px;color:var(--gray);margin-top:2px}
.trust-big{font-size:42px;font-weight:700;line-height:1}
.trust-big small{font-size:18px;color:var(--gray)}
.tier-badge{display:inline-block;font-size:11px;font-weight:700;padding:2px 10px;border-radius:3px;margin-top:4px}
.trust-bar{display:flex;align-items:center;margin:3px 0;font-size:11px}
.trust-bar .label{width:100px;color:var(--gray)}
.trust-bar .bar{flex:1;height:6px;background:#1e293b;border-radius:3px;margin:0 8px;overflow:hidden}
.trust-bar .bar-fill{height:100%;border-radius:3px;transition:width .3s}
.trust-bar .val{width:40px;text-align:right;font-family:'JetBrains Mono',monospace;font-size:10px}

.story-panel{background:rgba(14,165,233,.08);border:1px solid rgba(14,165,233,.2);border-radius:6px;padding:12px;margin-top:10px}
.story-panel h3{font-size:14px;color:var(--cyan);margin-bottom:2px}
.story-panel .story-subtitle{font-size:11px;color:var(--gray);font-style:italic;margin-bottom:8px}
.story-panel p{font-size:11px;line-height:1.5;color:var(--light);margin-bottom:8px}
.story-panel .why{background:rgba(234,179,8,.08);border-left:3px solid var(--yellow);padding:8px;margin-top:6px;border-radius:0 4px 4px 0}
.story-panel .why h4{font-size:10px;letter-spacing:1px;color:var(--yellow);margin-bottom:4px}
.story-panel .why p{font-size:11px;color:var(--light);margin:0}

.anomaly-alert{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:6px;padding:12px;margin-top:10px}
.anomaly-alert h3{font-size:12px;color:var(--red);margin-bottom:6px}
.anomaly-alert p{font-size:11px;line-height:1.5;color:var(--light)}

.timeline{margin-top:8px}
.timeline-item{display:flex;gap:8px;font-size:10px;padding:2px 0;border-left:2px solid var(--red);margin-left:4px;padding-left:8px}
.timeline-item .year{color:var(--red);font-weight:700;width:35px;flex-shrink:0}
.timeline-item .target{color:var(--light);flex:1}
.timeline-item .lon{color:var(--gray);flex-shrink:0}

.fact-list{margin-top:6px}
.fact-list div{font-size:11px;color:var(--light);padding:2px 0;padding-left:12px;position:relative}
.fact-list div::before{content:'\2192';position:absolute;left:0;color:var(--cyan)}

.pk-display{font-size:10px;color:var(--cyan);background:#0f172a;padding:6px 10px;border-radius:4px;word-break:break-all;margin-top:4px}
.chain-viz{display:flex;flex-wrap:wrap;gap:2px;margin-top:4px}
.chain-block{width:5px;height:14px;border-radius:1px}

.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--gray);font-size:14px;text-align:center;gap:12px}
.loading .spinner{width:24px;height:24px;border:3px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading small{font-size:11px;color:var(--gray);max-width:200px;line-height:1.5}

.no-selection{text-align:center;padding:40px 20px;color:var(--gray)}
.no-selection h2{font-size:16px;color:var(--light);margin-bottom:8px}
.no-selection p{font-size:12px;line-height:1.6}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center">
    <h1 class="mono">ORBITAL <span>TrIP</span></h1>
    <span class="subtitle">Public Identity Registry for Space Objects</span>
  </div>
  <div class="stats mono" id="headerStats">
    <div class="spinner" style="width:12px;height:12px;border:2px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite"></div>
    Loading live data...
  </div>
</header>

<div class="layout">
  <div class="left">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search satellites..." autocomplete="off">
    </div>
    <div class="filters" id="filters"></div>
    <ul class="sat-list" id="satList">
      <li class="loading"><div class="spinner"></div>Fetching satellites...</li>
    </ul>
  </div>

  <div class="center">
    <canvas id="map"></canvas>
    <div class="legend">
      <span class="l-odysseus">Odysseus</span>
      <span class="l-voyager">Voyager</span>
      <span class="l-pathfinder">Pathfinder</span>
      <span class="l-explorer">Explorer</span>
      <span class="l-seedling">Seedling</span>
    </div>
    <div class="data-source" id="dataSource"></div>
  </div>

  <div class="right" id="detailPanel">
    <div class="no-selection">
      <h2>Select a Satellite</h2>
      <p>Choose from the list to view its TrIP identity, trust score, and breadcrumb chain.</p>
      <p style="margin-top:16px;font-size:11px;color:var(--cyan)">This is a live public registry.<br>Data refreshes every 3 hours from CelesTrak.</p>
    </div>
  </div>
</div>

<script>
let DATA = null;
let selectedSat = null;
let activeFilter = "ALL";
let searchQuery = "";

const TIER_COLORS = {Odysseus:"#22c55e",Voyager:"#0ea5e9",Pathfinder:"#eab308",Explorer:"#f97316",Seedling:"#ef4444"};
const CAT_COLORS = {
  Station:"#22c55e","GEO Comms":"#a855f7","GEO Weather":"#06b6d4","Earth Obs":"#3b82f6",
  Navigation:"#f59e0b",Science:"#ec4899","LEO Constellation":"#0ea5e9",CubeSat:"#6366f1",
  Military:"#64748b",Suspicious:"#ef4444","Catastrophic Failure":"#dc2626",Deorbited:"#94a3b8",Debris:"#ef4444"
};

// ============================================================
// FETCH DATA (with retry for pipeline startup)
// ============================================================
let retryCount = 0;
async function loadData() {
  try {
    const res = await fetch("/api/satellites");
    if (res.status === 503) {
      // Pipeline still running — retry
      retryCount++;
      const list = document.getElementById("satList");
      list.innerHTML = `<li class="loading"><div class="spinner"></div>Pipeline running... (attempt ${retryCount})<small>Live TLE data is being fetched from CelesTrak and processed with SGP4 propagation.</small></li>`;
      setTimeout(loadData, 5000);
      return;
    }
    DATA = await res.json();
    init();
  } catch(e) {
    retryCount++;
    document.getElementById("satList").innerHTML = `<li class="loading"><div class="spinner"></div>Connecting... (attempt ${retryCount})</li>`;
    setTimeout(loadData, 3000);
  }
}

// ============================================================
// INIT
// ============================================================
function init() {
  const sats = DATA.satellites;
  const count = Object.keys(sats).length;
  const stories = Object.values(sats).filter(s => s.story).length;
  const tiers = {};
  Object.values(sats).forEach(s => { tiers[s.t.tier] = (tiers[s.t.tier] || 0) + 1; });

  document.getElementById("headerStats").innerHTML =
    `<div class="live-dot"></div> <b>${count}</b> satellites tracked &middot; <b>${stories}</b> stories &middot; Ed25519 &middot; SGP4`;

  // Data source badge
  const gen = DATA.generated ? new Date(DATA.generated) : null;
  const ago = gen ? Math.round((Date.now() - gen.getTime()) / 60000) : 0;
  const agoStr = ago < 60 ? `${ago}m ago` : `${Math.round(ago / 60)}h ago`;
  document.getElementById("dataSource").innerHTML =
    `Source: <b>${DATA.source || "Unknown"}</b> &middot; Updated ${agoStr}`;

  buildFilters();
  buildSatList();
  drawMap();

  // Auto-select first story satellite
  const storyNames = (DATA.leaderboard || Object.keys(sats)).filter(n => sats[n]?.story);
  if (storyNames.length) selectSat(storyNames[0]);

  // Search handler
  document.getElementById("searchInput").addEventListener("input", (e) => {
    searchQuery = e.target.value.toLowerCase();
    buildSatList();
    drawMap();
  });

  window.addEventListener("resize", drawMap);
}

// ============================================================
// FILTERS
// ============================================================
function buildFilters() {
  const cats = new Map([["ALL", 0]]);
  for (const s of Object.values(DATA.satellites)) {
    cats.set(s.c, (cats.get(s.c) || 0) + 1);
  }
  const container = document.getElementById("filters");
  container.innerHTML = "";
  for (const [cat, count] of cats) {
    const btn = document.createElement("button");
    btn.textContent = cat === "ALL" ? `ALL (${Object.keys(DATA.satellites).length})` : `${cat} (${count})`;
    btn.className = cat === activeFilter ? "active" : "";
    btn.onclick = () => { activeFilter = cat; buildFilters(); buildSatList(); drawMap(); };
    container.appendChild(btn);
  }
}

// ============================================================
// SATELLITE LIST
// ============================================================
function getFilteredNames() {
  const sats = DATA.satellites;
  return (DATA.leaderboard || Object.keys(sats)).filter(n => {
    if (!sats[n]) return false;
    if (activeFilter !== "ALL" && sats[n].c !== activeFilter) return false;
    if (searchQuery) {
      const s = sats[n];
      const haystack = `${n} ${s.o} ${s.c} ${s.n}`.toLowerCase();
      if (!haystack.includes(searchQuery)) return false;
    }
    return true;
  });
}

function buildSatList() {
  const list = document.getElementById("satList");
  list.innerHTML = "";
  const sats = DATA.satellites;
  const names = getFilteredNames();

  if (names.length === 0) {
    list.innerHTML = `<li class="loading" style="font-size:12px">No satellites match "${searchQuery}"</li>`;
    return;
  }

  for (const name of names) {
    const s = sats[name];
    const li = document.createElement("li");
    li.className = "sat-item" + (name === selectedSat ? " selected" : "") + (s.story ? " story" : "");
    li.onclick = () => selectSat(name);

    const tier = s.t.tier;
    const color = TIER_COLORS[tier] || "#64748b";
    const catColor = CAT_COLORS[s.c] || "#64748b";

    li.innerHTML = `
      <div class="sat-dot" style="background:${catColor}"></div>
      <div class="sat-info">
        <div class="sat-name">${name}${s.story ? '<span class="sat-story-badge">STORY</span>' : ''}</div>
        <div class="sat-meta">${s.o} &middot; ${s.p.length > 0 ? Math.round(s.p[0][2]).toLocaleString() + ' km' : 'N/A'}</div>
      </div>
      <div class="sat-score" style="color:${color};border-color:${color}">${s.t.total}</div>
    `;
    list.appendChild(li);
  }
}

// ============================================================
// SELECT & DETAILS
// ============================================================
function selectSat(name) {
  selectedSat = name;
  buildSatList();
  drawMap();
  renderDetails(name);
}

function renderDetails(name) {
  const panel = document.getElementById("detailPanel");
  const s = DATA.satellites[name];
  const t = s.t;
  const tierColor = TIER_COLORS[t.tier];
  const tierBg = tierColor + "22";

  let html = `
    <div class="section-title">Satellite Identity</div>
    <div class="detail-name">${name}</div>
    <div class="detail-sub">NORAD ${s.n} &middot; ${s.c} &middot; ${s.o}</div>

    <div class="section-title">Orbital TrIP Trust Score</div>
    <div class="trust-big" style="color:${tierColor}">${t.total}<small>/100</small></div>
    <div class="tier-badge" style="background:${tierBg};color:${tierColor}">${t.tier}</div>

    <div style="margin-top:10px">
      ${trustBar("Consistency", t.consistency, 35, tierColor)}
      ${trustBar("Compliance", t.compliance, 25, tierColor)}
      ${trustBar("Maturity", t.maturity, 20, tierColor)}
      ${trustBar("Corroboration", t.corroboration, 10, tierColor)}
      ${trustBar("Integrity", t.integrity, 10, tierColor)}
    </div>
  `;

  // Story panel
  if (s.story) {
    const st = s.story;
    html += `<div class="story-panel">
      <h3>${st.title}</h3>
      <div class="story-subtitle">${st.subtitle}</div>
      <p>${st.summary}</p>
      <div class="why"><h4>WHY IT MATTERS</h4><p>${st.why_it_matters}</p></div>`;

    if (st.timeline) {
      html += `<div class="section-title" style="color:var(--red)">Documented Approaches</div><div class="timeline">`;
      for (const ev of st.timeline) {
        html += `<div class="timeline-item"><span class="year">${ev.year}</span><span class="target">${ev.target}</span><span class="lon">${ev.longitude}</span></div>`;
      }
      html += `</div>`;
    }
    if (st.key_facts) {
      html += `<div class="section-title">Key Facts</div><div class="fact-list">`;
      for (const f of st.key_facts) html += `<div>${f}</div>`;
      html += `</div>`;
    }
    if (st.key_stats) {
      html += `<div class="section-title">Constellation Statistics</div><div class="fact-list">`;
      for (const f of st.key_stats) html += `<div>${f}</div>`;
      html += `</div>`;
    }
    html += `</div>`;
  }

  // Chain viz
  html += `
    <div class="section-title">Breadcrumb Chain (${s.trip.len} blocks)</div>
    <div class="chain-viz">${chainViz(s.trip.len, tierColor)}</div>
    <div style="font-size:10px;color:var(--gray);margin-top:4px">72h window &middot; 30-min intervals &middot; Ed25519 signed &middot; SHA-256 chained</div>

    <div class="section-title">Ed25519 Public Key</div>
    <div class="pk-display mono">${s.trip.pk.substring(0, 32)}...</div>

    <div class="section-title">Orbital Parameters</div>
    <div style="font-size:12px;line-height:1.8">
  `;

  if (s.p.length > 0) {
    const alts = s.p.map(p => p[2]);
    const minAlt = Math.round(Math.min(...alts));
    const maxAlt = Math.round(Math.max(...alts));
    const avgAlt = Math.round(alts.reduce((a,b)=>a+b,0)/alts.length);
    let regime = avgAlt > 30000 ? "Geostationary (GEO)" : avgAlt > 15000 ? "Medium Earth Orbit (MEO)" : avgAlt > 1500 ? "Low Earth Orbit (LEO) \u2014 high" : "Low Earth Orbit (LEO)";
    html += `Altitude: <b>${avgAlt.toLocaleString()} km</b> (${minAlt.toLocaleString()}\u2013${maxAlt.toLocaleString()})<br>Ground track points: <b>${s.p.length}</b><br>Regime: <b>${regime}</b>`;
  }

  html += `</div>`;
  panel.innerHTML = html;
}

function trustBar(label, value, max, color) {
  const pct = (value / max * 100).toFixed(0);
  return `<div class="trust-bar"><span class="label">${label}</span><div class="bar"><div class="bar-fill" style="width:${pct}%;background:${color}"></div></div><span class="val">${value}/${max}</span></div>`;
}

function chainViz(len, color) {
  let html = "";
  const shown = Math.min(len, 80);
  for (let i = 0; i < shown; i++) {
    const opacity = 0.3 + (i / shown) * 0.7;
    html += `<div class="chain-block" style="background:${color};opacity:${opacity}"></div>`;
  }
  return html;
}

// ============================================================
// MAP
// ============================================================
function drawMap() {
  if (!DATA) return;
  const canvas = document.getElementById("map");
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  canvas.style.width = rect.width + "px";
  canvas.style.height = rect.height + "px";
  const ctx = canvas.getContext("2d");
  ctx.scale(dpr, dpr);
  const W = rect.width, H = rect.height;

  ctx.fillStyle = "#0a0e17";
  ctx.fillRect(0, 0, W, H);

  // Grid
  ctx.strokeStyle = "#1e293b";
  ctx.lineWidth = 0.5;
  for (let lon = -180; lon <= 180; lon += 30) {
    const x = ((lon + 180) / 360) * W;
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke();
  }
  for (let lat = -90; lat <= 90; lat += 30) {
    const y = ((90 - lat) / 180) * H;
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
  }

  // Equator
  ctx.strokeStyle = "#1e293b88";
  ctx.lineWidth = 1;
  const eqY = H / 2;
  ctx.beginPath(); ctx.moveTo(0, eqY); ctx.lineTo(W, eqY); ctx.stroke();

  // GEO belt
  const geoY1 = ((90 - 5) / 180) * H;
  const geoY2 = ((90 + 5) / 180) * H;
  ctx.fillStyle = "rgba(14,165,233,0.03)";
  ctx.fillRect(0, geoY1, W, geoY2 - geoY1);
  ctx.fillStyle = "rgba(14,165,233,0.12)";
  ctx.font = "10px 'DM Sans'";
  ctx.fillText("GEO BELT", 8, geoY1 + 12);

  const sats = DATA.satellites;
  const filteredNames = getFilteredNames();

  // Draw all ground tracks
  for (const name of filteredNames) {
    const s = sats[name];
    if (!s?.p?.length) continue;
    const isSelected = name === selectedSat;
    const tierColor = TIER_COLORS[s.t.tier] || "#64748b";

    ctx.strokeStyle = isSelected ? tierColor : tierColor + "25";
    ctx.lineWidth = isSelected ? 1.5 : 0.4;
    ctx.beginPath();
    let prevX = null;
    for (const pt of s.p) {
      const x = ((pt[1] + 180) / 360) * W;
      const y = ((90 - pt[0]) / 180) * H;
      if (prevX !== null && Math.abs(x - prevX) > W * 0.4) {
        ctx.stroke(); ctx.beginPath();
      }
      if (prevX === null) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      prevX = x;
    }
    ctx.stroke();

    // Current position
    const last = s.p[s.p.length - 1];
    const cx = ((last[1] + 180) / 360) * W;
    const cy = ((90 - last[0]) / 180) * H;
    const r = isSelected ? 5 : (s.story ? 3.5 : 2);
    ctx.fillStyle = tierColor;
    ctx.globalAlpha = isSelected ? 1 : 0.6;
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI * 2); ctx.fill();
    ctx.globalAlpha = 1;

    // Labels
    if (isSelected || s.story) {
      ctx.fillStyle = isSelected ? "#f8fafc" : "#94a3b8";
      ctx.font = isSelected ? "bold 11px 'JetBrains Mono'" : "9px 'DM Sans'";
      ctx.fillText(name, cx + r + 3, cy + 3);
    }
  }

  // Click handler
  canvas.onclick = (e) => {
    const r2 = canvas.getBoundingClientRect();
    const mx = e.clientX - r2.left;
    const my = e.clientY - r2.top;
    let closest = null, closestDist = 20;
    for (const name of filteredNames) {
      const s = sats[name];
      if (!s?.p?.length) continue;
      const last = s.p[s.p.length - 1];
      const cx = ((last[1] + 180) / 360) * W;
      const cy = ((90 - last[0]) / 180) * H;
      const d = Math.sqrt((mx-cx)**2 + (my-cy)**2);
      if (d < closestDist) { closestDist = d; closest = name; }
    }
    if (closest) selectSat(closest);
  };
}

// ============================================================
// BOOT
// ============================================================
loadData();
</script>
</body>
</html>
